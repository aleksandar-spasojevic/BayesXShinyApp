%---------------------------------------------
%Author: Nadja Klein, nklein@uni-goettingen.de
%---------------------------------------------
%before running the scripts in BayesX (copy the following line without "%" into the command line of BayesX and press "Enter") please replace YOURPATH appropriately.

% usefile YOURPATH/prg/NV_s1_di_ca_me_mb_br_ma_s2_di_ca_mb_br_rho_ca_di_ma_br.txt

%open a log file that stores details about the MCMC run
logopen using YOURPATH/results/log_NV_s1_di_ca_me_mb_br_ma_s2_di_ca_mb_br_rho_ca_di_ma_br.txt

%read data


dataset d
d.infile using YOURPATH/data/india.raw
d.generate distH2 = distH
d.generate distH3 = distH
d.generate distH4 = distH
d.generate distH5 = distH
d.generate distH6 = distH
d.generate distH7 = distH
d.generate distH8 = distH
d.generate distH9 = distH
d.generate distH10 = distH

%load map
map m
m. infile using YOURPATH/data/india_dist_sort.bnd

mcmcreg yreg

%path for storing the results
yreg.outfile = YOURPATH/results/NV_s1_di_ca_me_mb_br_ma_s2_di_ca_mb_br_rho_ca_di_ma_br


%level 1 equation for rho
yreg.hregress stunting2=const+cage(pspline,lambda=100)+distH9(spatial,map=m,lambda=100)+mage(pspline,lambda=100)+breastfeeding(pspline,lambda=100)+csex+ctwin+munemployed+motorcycle+mreligion2+mreligion3+mreligion4+mreligion5+electricity+radio+television+refrigerator+bicycle+car,hlevel=1 family=bivnormal equationtype=rho iterations=52000 step=50 burnin=2000 using d

%level 1 equation for sigma2
yreg.hregress wasting2=const+distH7(spatial,map=m,lambda=100)+cage(pspline,lambda=100)+mbmi(pspline,lambda=100)+csex+ctwin+munemployed+motorcycle+mreligion2+mreligion3+mreligion4+mreligion5+electricity+radio+television+refrigerator+bicycle+car, hlevel=1 family=bivnormal equationtype=sigma using d

%level 1 equation for sigma1
yreg.hregress stunting2=const+distH5(spatial,map=m,lambda=100)+cage(pspline,lambda=100)+medu(pspline,lambda=100)+breastfeeding(pspline,lambda=100)+mage(pspline,lambda=100)+mbmi(pspline,lambda=100)+csex+ctwin+munemployed+motorcycle+mreligion2+mreligion3+mreligion4+mreligion5+electricity+radio+television+refrigerator+bicycle+car,hlevel=1  family=bivnormal equationtype=sigma using d

%level 1 equation for mu2
yreg.hregress wasting2=const+cage(pspline,lambda=100)+breastfeeding(pspline,lambda=100)+mbmi(pspline,lambda=100)+mage(pspline,lambda=100)+medu(pspline,lambda=100)+edupartner(pspline,lambda=100)+distH3(spatial,map=m,lambda=100)+csex+ctwin+munemployed+motorcycle+mreligion2+mreligion3+mreligion4+mreligion5+electricity+radio+television+refrigerator+bicycle+car, hlevel=1 family=bivnormal equationtype=mu using d

%level 1 equation for mu1
yreg.hregress stunting2=const+cage(pspline,lambda=100)+breastfeeding(pspline,lambda=100)+mbmi(pspline,lambda=100)+mage(pspline,lambda=100)+medu(pspline,lambda=100)+edupartner(pspline,lambda=100)+distH(spatial,map=m,lambda=100)+csex+ctwin+munemployed+motorcycle+mreligion2+mreligion3+mreligion4+mreligion5+electricity+radio+television+refrigerator+bicycle+car,hlevel=1 predict=light setseed=320248 family=bivnormal equationtype=mu using d

%get data for samples
yreg.getsample

drop d
drop yreg

logclose
